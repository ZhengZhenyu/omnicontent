# 产品需求文档（PRD）
# openGecko —— 以社区为中心的项目经理工作平台

---

**产品/功能名称：** openGecko 社区中心化体验改造
**状态：** 草稿（Draft）
**作者：** openGecko 产品团队
**相关文档：** `docs/plannings/02-综合重构计划.md`
**创建日期：** 2026-02-20
**最后更新：** 2026-02-20
**版本：** 1.2

---

## 目录

1. [执行摘要](#执行摘要)
2. [问题陈述](#问题陈述)
3. [目标与目的](#目标与目的)
4. [用户画像](#用户画像)
5. [用户故事与需求](#用户故事与需求)
6. [成功指标](#成功指标)
7. [范围](#范围)
8. [技术考量](#技术考量)
9. [设计与用户体验要求](#设计与用户体验要求)
10. [时间线与里程碑](#时间线与里程碑)
11. [风险与缓解措施](#风险与缓解措施)
12. [依赖与假设](#依赖与假设)
13. [待解决问题](#待解决问题)

---

## 执行摘要

**一句话概括：** 将 openGecko 从以"功能模块"为导航核心的管理工具，改造为以"社区"为中心、让项目经理一进入系统就能感知当前社区整体运营状态的专属工作平台。

**概述：**

openGecko 是一个服务于开源社区的多租户运营管理平台，涵盖内容管理、多渠道发布、委员会治理、成员管理和数据分析等核心功能。然而，当前系统的设计逻辑来自"工程师思维"——用户需要在"内容管理"、"发布管理"、"委员会"、"成员"等功能页面之间反复跳转，才能拼凑出一个社区的整体状态。对于主要使用者——社区项目经理（PM）而言，这意味着高认知负担和低操作效率。

本次改造的核心目标是：**让"社区"成为系统的第一公民**。PM 登录后看到的第一个页面，是他所负责的社区的全貌——内容状态、成员规模、即将召开的会议、渠道发布效果，以及需要立即处理的待办事项。所有功能入口从"我有哪些工具"重构为"我在管理哪个社区、社区现在怎么样、我接下来要做什么"。

这一改造不仅是体验层面的提升，也涉及后端 API 聚合重构（解决 N+1 查询）、多租户安全漏洞修复、以及生产部署加固，使系统具备开源社区真实运营所需的可靠性。

**权限分层：** 本次改造明确了三级权限模型：
- **平台超级管理员（Superuser）：** 负责社区创建、删除和关键配置（SMTP、渠道凭证）
- **社区管理员（Admin）：** 负责日常运营，可编辑社区基本信息、管理成员和内容
- **普通用户（User）：** 参与内容创作，无管理权限

**关键数据：**
- **目标用户：** 开源社区管理员（Admin）、平台超级管理员（Superuser）
- **核心问题：** 以功能模块为中心的导航，导致管理员完成日常工作流需要 5+ 次页面跳转；关键配置权限不清晰
- **关键指标：** 日常工作流跳转次数减少 ≥ 50%，新社区初始化时间 < 10 分钟（超管）
- **目标上线：** 2026 年 Q2

---

## 问题陈述

### 当前问题

**社区 PM 的核心工作痛点：无法快速掌握"我的社区现在怎么样"。**

当一位 PM 早上登录 openGecko，想了解社区运营状况并安排当天工作时，他需要：
1. 打开"内容管理"，查看有没有待审核的文章
2. 切换到"社区治理"，看看本周有没有委员会会议
3. 再切换到"发布管理"，查看上周各渠道的发布情况
4. 最后去"成员管理"，确认有没有新的成员申请

这四个信息分散在四个模块，每次切换都需要重新定向。对于一个每天都要做这些事情的 PM 来说，这是不必要的摩擦。

### 当前状态分析

| 问题 | 具体表现 | 影响程度 |
|------|----------|----------|
| 导航以功能为中心 | 菜单项为"内容管理/发布管理/社区治理"，而非"我的社区概览" | 高 |
| 缺少社区工作台 | 无单一页面展示社区整体状态 | 高 |
| 设置入口分散 | 渠道配置在 Settings.vue，邮件/成员设置在 CommunityManage 对话框 | 中 |
| 权限边界不清晰 | 社区管理员和超级管理员的权限边界模糊，关键配置（SMTP、渠道凭证）无明确归属 | 高（安全） |
| 社区创建流程缺失 | 无清晰的社区创建入口和引导，新社区上线依赖手工配置 | 中 |
| 新社区上手困难 | 无引导流程，用户需自行探索各设置页 | 中 |
| 切换社区体验割裂 | 切换社区后无明显语境变化，数据不联动 | 中 |
| N+1 查询性能问题 | CommunityOverview 每个社区发 3-4 个独立请求 | 中（性能） |
| 多租户安全漏洞 | analytics.py `get_overview` 缺少 `community_id` 过滤 | 高（安全） |
| CORS 配置宽松 | `allow_origins=["*"]` 在生产环境存在安全风险 | 高（安全） |

### 影响评估

**对用户的影响：**
- PM 完成"查看社区状态→处理待审内容→跟进会议"的日常工作流，平均需要 5-7 次页面切换
- 新社区 PM 从账号激活到完成第一次内容发布，需要自行摸索 30+ 分钟
- 切换管理多个社区时，容易混淆当前操作的社区上下文

**对平台的影响：**
- 多租户安全漏洞可能导致跨社区数据泄露（高优先级）
- N+1 查询随社区数量增长导致性能线性下降
- 结构化日志缺失，线上问题排查困难

### 为什么现在做

1. **安全优先：** analytics 多租户漏洞和 CORS 配置需要立即修复
2. **用户增长临界点：** 随着平台社区数量增加，工程师思维的 UX 将成为用户留存的主要阻力
3. **技术债窗口：** N+1 查询和 print() 日志在当前代码规模下改造成本最低

---

## 目标与目的

### 业务目标

1. **提升用户留存：** 通过降低日常操作摩擦，使 PM 每周使用 openGecko 的频率从当前的 3 次/周提升到 5 次/周
2. **加速新用户激活：** 通过初始化向导，将新社区 PM 从"账号激活"到"首次发布内容"的时间缩短至 10 分钟以内
3. **消除安全风险：** 修复多租户漏洞和 CORS 配置，使平台满足开源社区生产部署的安全要求
4. **建立可扩展的平台基础：** 聚合 API、结构化日志、速率限制，为支持更多社区做技术准备

### 用户目标

1. **即时感知社区状态：** PM 打开系统，3 秒内知道"社区现在怎么样、我今天要做什么"
2. **减少工作流摩擦：** 80% 的日常操作（查看状态、处理内容、跟进会议）在一个页面完成
3. **轻松上手新社区：** 通过引导向导完成社区初始化，无需阅读文档
4. **清晰的多社区管理：** 管理多个社区时，切换操作明确，不产生上下文混淆

### 非目标（明确不做的事）

- 不改变现有内容编辑器的功能和交互
- 不重构后端数据模型或 RBAC 权限逻辑
- 不引入实时（WebSocket）推送能力
- 不新增移动端适配（保持当前响应式支持水平）
- 不实现自定义仪表板（拖拽式 widget 布局）

---

## 用户画像

### 主要用户：社区项目经理（Community Admin）

**角色特征：**
- 职责：负责开源社区的内容运营、委员会治理、成员管理和数据分析
- 技术水平：中等（熟悉 SaaS 工具，不一定懂开发）
- 使用频率：每天登录，每次使用 15-45 分钟
- 管理规模：通常管理 1-2 个社区，偶尔管理 3 个以上

**权限范围：**
- ✅ **可以做：** 编辑社区基本信息（名称、描述、Logo）、内容管理、成员邀请与角色管理、会议管理、查看数据分析
- ❌ **不可以做：** 创建新社区、删除社区、修改社区关键配置（SMTP、渠道凭证等）

**核心行为模式：**
- 每天早上"巡检"社区状态（内容/会议/成员）
- 在不同模块间切换完成工作流（内容→审核→发布→治理）
- 需要定期向社区委员会汇报运营数据

**痛点：**
- 每天需要重复打开多个页面才能了解社区全貌
- 找不到"所有设置在哪里"，配置散落各处
- 无法自行修改关键配置（SMTP、渠道凭证），需要联系平台超管
- 但基本信息（社区名称、Logo）应该能自己编辑

**用户引言：** _"我每天第一件事就是打开几个不同的页面，看看内容审核、会议安排、成员情况……要是有个地方能一眼看全就好了。虽然我不需要改SMTP设置，但至少社区名称和Logo我应该能自己改。"_

---

### 次要用户：社区普通用户（Community User）

**角色特征：**
- 职责：参与内容创作、会议记录等日常事务
- 技术水平：中等偏低
- 使用频率：每周 3-5 次，每次 10-30 分钟

**权限范围：**
- ✅ **可以做：** 查看社区内容、创建草稿、参加会议
- ❌ **不可以做：** 审核内容、邀请成员、查看设置页面

**核心需求：**
- 快速处理分配给自己的内容任务
- 查看社区会议安排
- 无需理解整个系统架构，按任务驱动使用

---

### 管理角色：平台超级管理员（Superuser）

**角色特征：**
- 职责：跨社区管理整个平台，负责社区全生命周期管理（创建、删除、关键配置）
- 使用频率：低频但关键操作
- 技术水平：高（理解系统架构和安全配置）

**权限范围：**
- ✅ **可以做：** 创建社区、删除社区、修改所有社区配置（SMTP、渠道凭证、成员权限等）、一览所有社区健康状态
- ✅ **唯一可以做：** 配置 SMTP 邮件服务器、配置渠道发布凭证（微信/Hugo/CSDN/知乎）、社区的完整删除

**核心需求：**
- 快速创建和初始化新社区（通过向导）
- 一览所有社区的健康状态，快速定位问题社区
- 统一管理关键安全配置（SMTP、API 凭证），避免凭证泄露风险

---

### 权限矩阵（Permission Matrix）

以下表格明确了三级角色的权限边界：

| 功能 | 超级管理员（Superuser） | 社区管理员（Admin） | 普通用户（User） |
|------|------------------------|-------------------|----------------|
| **社区生命周期** | | | |
| 创建新社区 | ✅ 可以 | ❌ 不可以 | ❌ 不可以 |
| 删除社区 | ✅ 可以 | ❌ 不可以 | ❌ 不可以 |
| **社区基本信息** | | | |
| 编辑社区名称、描述、Logo | ✅ 可以 | ✅ 可以 | ❌ 不可以 |
| 查看社区基本信息 | ✅ 可以 | ✅ 可以 | ✅ 可以 |
| **关键配置** | | | |
| 配置 SMTP 邮件服务器 | ✅ 可以 | ❌ 不可以 | ❌ 不可以 |
| 配置渠道凭证（微信/Hugo/CSDN/知乎） | ✅ 可以 | ❌ 不可以 | ❌ 不可以 |
| 查看渠道配置 | ✅ 可以 | ❌ 不可以 | ❌ 不可以 |
| **成员管理** | | | |
| 邀请成员 | ✅ 可以 | ✅ 可以 | ❌ 不可以 |
| 修改成员角色 | ✅ 可以 | ✅ 可以 | ❌ 不可以 |
| 移除成员 | ✅ 可以 | ✅ 可以 | ❌ 不可以 |
| 查看成员列表 | ✅ 可以 | ✅ 可以 | ✅ 可以 |
| **内容管理** | | | |
| 创建内容 | ✅ 可以 | ✅ 可以 | ✅ 可以 |
| 审核内容 | ✅ 可以 | ✅ 可以 | ❌ 不可以 |
| 发布内容 | ✅ 可以 | ✅ 可以 | ❌ 不可以 |
| **社区工作台** | | | |
| 访问社区工作台 | ✅ 可以 | ✅ 可以 | ✅ 可以（功能受限） |
| 查看社区数据分析 | ✅ 可以 | ✅ 可以 | ❌ 不可以 |
| **平台级功能** | | | |
| 访问所有社区总览页 | ✅ 可以 | ❌ 不可以 | ❌ 不可以 |
| 使用社区初始化向导 | ✅ 可以 | ❌ 不可以 | ❌ 不可以 |

**设计原则：**
1. **最小权限原则（Principle of Least Privilege）：** 每个角色仅拥有完成其职责所需的最小权限
2. **职责分离（Separation of Duties）：** 关键配置（SMTP、API 凭证）与日常运营分离，降低凭证泄露风险
3. **可审计性（Auditability）：** 所有关键操作（创建/删除社区、修改配置）记录审计日志

---

## 用户故事与需求

### Epic 1：社区工作台（Community Sandbox）

#### P0 必须实现

---

##### Story 1.1：社区状态一览

**用户故事：**
```
作为社区项目经理，
我想要在登录后立即看到当前社区的整体运营状态，
以便快速了解今日工作重点，无需跨页面收集信息。
```

**验收标准：**
- [ ] 社区工作台为登录后的默认落地页（选中社区后）
- [ ] 页面顶部显示当前社区名称、Logo（若有）和简短描述
- [ ] 显示 8 个核心指标卡片：内容总数、已发布内容、待审核内容、草稿内容；委员会数、成员总数、即将召开会议数、活跃渠道数
- [ ] 指标卡片数据通过单个 API 请求获取，页面整体加载 < 1 秒
- [ ] 指标卡片支持点击跳转到对应功能页面（如点击"待审核 3"跳转内容管理并过滤待审核状态）

**优先级：** P0（Must Have）
**工作量估计：** L（5-8 人天）
**依赖：** 后端聚合 API（Story 5.1）

---

##### Story 1.2：内容发布趋势图

**用户故事：**
```
作为社区项目经理，
我想要查看近 6 个月的内容发布趋势，
以便评估社区内容产出节奏并做运营决策。
```

**验收标准：**
- [ ] 工作台展示近 6 个月（按月聚合）的内容发布折线图
- [ ] X 轴为月份，Y 轴为发布数量
- [ ] 图表支持鼠标悬停显示具体数值
- [ ] 渠道发布统计以条形图展示，区分微信/Hugo/CSDN/知乎各渠道的发布数量
- [ ] 两图并排展示，各占约 50% 宽度

**优先级：** P0（Must Have）
**工作量估计：** M（3-5 人天）
**依赖：** Story 5.1，ECharts/vue-echarts 依赖引入

---

##### Story 1.3：工作队列（待处理事项）

**用户故事：**
```
作为社区项目经理，
我想要在工作台看到最近的内容和即将召开的会议，
以便不遗漏需要跟进的事项。
```

**验收标准：**
- [ ] 工作台下方展示"最近内容"列表：显示最新 5 条内容，包含标题、状态标签（草稿/审核中/已批准/已发布）、创建时间、负责人
- [ ] 工作台下方展示"即将召开的会议"列表：显示最近 5 场会议，包含会议名称、召开时间、委员会名称
- [ ] 两个列表并排展示，各占约 50% 宽度
- [ ] 每项均支持点击跳转到对应详情页

**优先级：** P0（Must Have）
**工作量估计：** M（3-4 人天）
**依赖：** Story 5.1

---

##### Story 1.4：快捷操作按钮（按权限显示）

**用户故事：**
```
作为社区管理员，
我想要在工作台直接触发最常用的操作，
以便减少跨页面跳转次数。
```

**验收标准：**
- [ ] 工作台顶部 Header 区域提供快捷操作按钮组（根据用户角色动态显示）
- [ ] **所有角色可见：** 「新建内容」直接跳转到内容创建页，并预设当前社区上下文
- [ ] **仅管理员可见：** 「邀请成员」打开邀请成员对话框（带角色选择）；普通用户不显示此按钮
- [ ] **仅管理员可见：** 「社区设置」跳转到统一社区设置中心（Story 3.1）；普通用户不显示此按钮
- [ ] 按钮权限检查：前端通过 `authStore.isCommunityAdmin` 或 `authStore.isSuperuser` 控制显示

**优先级：** P0（Must Have）
**工作量估计：** S（1-2 人天）
**依赖：** Story 3.1、权限状态管理

---

#### P1 应该实现

---

##### Story 1.5：新社区引导触发

**用户故事：**
```
作为刚创建社区的项目经理，
当我进入工作台发现社区尚未配置时，
我希望系统主动引导我完成初始化，
以便快速开始运营。
```

**验收标准：**
- [ ] 当社区工作台检测到社区内容数为 0 且活跃渠道数为 0 时，展示引导提示横幅
- [ ] 引导横幅内容：「您的社区还没有配置内容，点击开始引导来完成社区初始化」，附「开始引导」按钮
- [ ] 点击「开始引导」按钮打开社区初始化向导（Story 2.1）
- [ ] 引导横幅支持关闭（关闭后本次会话不再显示）

**优先级：** P1（Should Have）
**工作量估计：** S（1-2 人天）
**依赖：** Story 2.1（初始化向导）

---

##### Story 1.6：社区事件日历视图

**用户故事：**
```
作为社区管理员，
我想要在工作台看到一个直观的日历视图展示社区所有重要事件，
以便快速了解社区的活动节奏和即将到来的重要事项。
```

**验收标准：**
- [ ] 工作台展示月度日历组件（使用 Element Plus Calendar 或 FullCalendar）
- [ ] 日历上标记不同类型的事件，使用颜色区分：
  - **会议事件（蓝色 `#0095ff`）：** 委员会会议、临时会议
  - **内容发布（绿色 `#10b981`）：** 计划发布的内容、已发布的重要内容
  - **成员活动（橙色 `#f59e0b`）：** 新成员加入、成员周年纪念
  - **其他活动（紫色 `#8b5cf6`）：** 社区重要里程碑、活动截止日期
- [ ] 日历单元格支持显示最多 3 个事件标记（圆点或小标签），超过 3 个显示 `+N` 提示
- [ ] 点击日期单元格，在侧边抽屉或弹窗中展示当天所有事件详情
- [ ] 日历下方展示「即将到来的事件」列表（未来 7 天），每项包含：事件类型图标、标题、时间、类型标签
- [ ] 支持月份前进/后退切换（默认显示当前月）
- [ ] 日历事件数据通过工作台聚合 API 返回（`events` 字段）
- [ ] 点击事件可跳转到对应详情页（会议详情、内容详情等）

**优先级：** P1（Should Have）
**工作量估计：** L（6-8 人天）
**依赖：** Story 5.1（工作台聚合 API 需增加 events 字段）、Element Plus Calendar 或 FullCalendar 库

---

### Epic 2：社区初始化向导（Onboarding Wizard）

#### P0 必须实现

---

##### Story 2.1：五步初始化向导（仅超级管理员可用）

**用户故事：**
```
作为平台超级管理员，
我想要通过一个分步引导完成新社区的创建和基础配置，
以便在 10 分钟内让社区具备运营能力，然后邀请社区管理员接手日常运营。
```

**验收标准：**
- [ ] ⚠️ **权限控制：** 向导入口仅对 Superuser 可见（前端 `v-if="authStore.isSuperuser"`）
- [ ] 向导使用 `el-steps` 展示 5 个步骤，支持查看进度
- [ ] **Step 1 - 基本信息：** 填写社区名称、标识（slug）、描述、官网 URL、Logo 上传；必填项有实时校验
- [ ] **Step 2 - 渠道配置：** ⚠️ **超管专属** 展示支持的渠道（微信公众号、Hugo、CSDN、知乎）；选择要启用的渠道并填写对应凭证；跳过渠道配置也允许继续
- [ ] **Step 3 - 邮件设置：** ⚠️ **超管专属** SMTP 配置表单；根据发件人邮箱域名自动填充服务器预设（qq.com→smtp.qq.com:465, gmail.com→smtp.gmail.com:587, 163.com→smtp.163.com:465, outlook.com→smtp.office365.com:587）；提供「发送测试邮件」功能；邮件设置可跳过
- [ ] **Step 4 - 邀请成员：** 支持输入邮箱列表批量邀请；为每个被邀请者选择角色（Admin/User）；**建议至少邀请 1 位社区管理员接手日常运营**；至少邀请 0 人即可继续（跳过）
- [ ] **Step 5 - 完成：** 展示配置摘要（哪些步骤已完成/跳过），提示「已邀请 X 位管理员，他们将通过邮件收到激活链接」；点击「进入社区工作台」跳转
- [ ] 向导支持在步骤间前进/后退，不丢失已填写数据
- [ ] 向导完成或关闭时，数据已保存到后端
- [ ] 后端 API 验证请求者为 Superuser（`Depends(get_current_active_superuser)`）

**优先级：** P0（Must Have）
**工作量估计：** XL（10-15 人天）
**依赖：** 现有渠道配置 API、SMTP 配置 API、权限检查中间件

---

### Epic 3：统一社区设置中心

#### P0 必须实现

---

##### Story 3.1：设置中心统一入口（分权限分层展示）

**用户故事：**
```
作为社区管理员，
我想要在一个页面查看和编辑我有权限修改的社区配置，
以便不再需要在多个散落的页面之间寻找设置入口。

作为平台超级管理员，
我想要在社区设置页面访问所有关键配置（SMTP、渠道凭证、社区删除），
以便集中管理平台的安全配置。
```

**验收标准：**
- [ ] 新增「社区设置」页面（路由：`/community-settings`），使用 `el-tabs` 组织设置
- [ ] **Tab 1 - 基本信息：**
  - 社区名称、标识（slug）、描述、URL、Logo（原 CommunityManage 对话框功能迁移）
  - **权限：** 社区管理员（Admin）可编辑；普通用户（User）只读
- [ ] **Tab 2 - 渠道配置：** ⚠️ **仅超级管理员可见**
  - 现有 Settings.vue 中渠道配置功能迁移
  - 支持启用/禁用各渠道、修改凭证（微信/Hugo/CSDN/知乎）
  - **权限：** 仅 Superuser 可访问；社区管理员无此 Tab，后端 API 返回 403
- [ ] **Tab 3 - 邮件设置：** ⚠️ **仅超级管理员可见**
  - SMTP 配置（原 CommunityManage 对话框功能迁移），含自动识别和测试功能
  - **权限：** 仅 Superuser 可访问；社区管理员无此 Tab，后端 API 返回 403
- [ ] **Tab 4 - 成员管理：**
  - 社区成员列表、修改角色、移除成员、邀请新成员（原 CommunityManage 对话框功能迁移）
  - **权限：** 社区管理员（Admin）可管理成员和分配角色
- [ ] **Tab 5 - 危险操作：** ⚠️ **仅超级管理员可见**
  - 社区删除操作（需要二次确认，输入社区标识 slug 确认）
  - **权限：** 仅 Superuser 可访问
- [ ] 前端根据用户角色动态渲染 Tab，社区管理员看到 Tab 1、4；超级管理员看到全部 Tab 1-5
- [ ] 原有功能页面（Settings.vue 中的渠道配置部分）保留入口或重定向至新页面，避免链接失效

**优先级：** P0（Must Have）
**工作量估计：** L（8-12 人天，增加了权限控制逻辑）
**依赖：** 现有各设置相关 API + 权限检查中间件（`get_current_active_superuser`）

---

##### Story 3.2：社区创建入口（仅超级管理员）

**用户故事：**
```
作为平台超级管理员，
我想要从一个清晰的入口创建新社区，
以便通过初始化向导快速完成新社区的配置和上线。
```

**验收标准：**
- [ ] ⚠️ **权限控制：** 「创建社区」入口仅对 Superuser 可见
- [ ] **超管社区总览页（CommunityOverview.vue）：** 新增「创建社区」按钮（右上角主要按钮位置）
- [ ] 点击「创建社区」打开社区初始化向导（Story 2.1 中的五步向导）
- [ ] 向导完成后，自动跳转到新创建社区的工作台页面
- [ ] 社区管理员无法看到「创建社区」按钮和相关入口
- [ ] 后端 API `POST /api/communities` 强制检查 `Depends(get_current_active_superuser)`

**优先级：** P0（Must Have）
**工作量估计：** S（2-3 人天）
**依赖：** Story 2.1（初始化向导）、权限检查中间件

---

### Epic 4：导航重组与社区上下文

#### P0 必须实现

---

##### Story 4.1：以社区为中心的导航结构

**用户故事：**
```
作为社区项目经理，
我想要导航菜单反映我正在管理的社区工作流，
以便快速找到与当前社区任务相关的功能。
```

**验收标准：**
- [ ] 导航菜单重组为：`社区工作台 > 内容管理 > 发布管理 > 社区治理 > 社区设置 > [超管菜单（仅超管可见）]`
- [ ] 移除原末尾的「仪表板」菜单项（功能被社区工作台取代）
- [ ] 「社区工作台」设为选中社区后的默认落地页
- [ ] 导航菜单始终显示当前选中社区名称（通过 CommunitySwitcher 展示）

**优先级：** P0（Must Have）
**工作量估计：** S（2-3 人天）
**依赖：** Story 4.2

---

##### Story 4.2：社区切换上下文联动

**用户故事：**
```
作为管理多个社区的项目经理，
当我切换当前社区时，
所有页面数据应立即更新到新社区的上下文，
以便我不会混淆正在操作的社区。
```

**验收标准：**
- [ ] CommunitySwitcher 切换社区后，若用户在社区工作台（全局页面），自动跳转到新社区的 `/sandbox`
- [ ] 若用户在社区级功能页（如内容管理），切换社区后留在当前页并重新加载当前社区数据
- [ ] 页面顶部（导航栏）始终清晰展示当前社区名称，切换后立即更新
- [ ] Pinia store 中的 `currentCommunity` 状态在切换时正确更新，所有组件响应

**优先级：** P0（Must Have）
**工作量估计：** M（3-4 人天）
**依赖：** Story 4.1

---

### Epic 5：后端 API 增强与安全加固

#### P0 必须实现（安全类）

---

##### Story 5.1：社区工作台聚合 API

**用户故事：**
```
作为系统（工程需求），
需要提供一个聚合端点，
一次性返回社区工作台所需的全部数据，
以便前端减少请求次数并达到 < 1 秒加载目标。
```

**验收标准：**
- [ ] 新增端点：`GET /api/communities/{community_id}/dashboard`
- [ ] 响应包含以下字段：
  - `content_metrics`：总数/按状态分布/近7天/近30天新增
  - `governance_metrics`：委员会数/活跃委员会/成员总数/即将会议/近期完成会议
  - `member_metrics`：总数/角色分布
  - `channel_metrics`：渠道总数/已启用/各渠道发布计数
  - `content_publish_trend`：近6月 labels + values（折线图数据）
  - `recent_contents`：最新5条内容摘要
  - `upcoming_meetings`：即将召开的5场会议
  - **`events`（新增）**：社区事件列表，每个事件包含 `{ id, title, type, date, description, link }`，其中 type 可选值为 `meeting`、`content_publish`、`member_join`、`other`
- [ ] 端点强制 `community_id` 过滤，不返回其他社区数据
- [ ] 响应时间 p95 < 500ms（events 数据查询优化，仅返回未来 3 个月和过去 1 个月的事件）
- [ ] 新增对应 Pydantic Schema：`backend/app/schemas/community_dashboard.py`
- [ ] events 字段聚合来源：meetings 表（会议事件）、publish_records 表（内容发布事件）、community_users 表（成员加入事件）

**优先级：** P0（Must Have）
**工作量估计：** L（7-10 人天，增加了 events 聚合逻辑）

---

##### Story 5.2：修复 analytics 多租户安全漏洞

**用户故事：**
```
作为系统安全（工程需求），
analytics.py 的 get_overview 端点必须添加 community_id 过滤，
以防止跨社区数据泄露。
```

**验收标准：**
- [ ] `backend/app/api/analytics.py` 的 `get_overview` 端点通过 `Depends(get_current_community)` 注入 `community_id`
- [ ] 所有查询均使用 `community_id` 过滤
- [ ] 新增测试用例，验证用户 A 无法通过 analytics API 获取社区 B 的数据

**优先级：** P0（Must Have）
**工作量估计：** S（1-2 人天）

---

##### Story 5.3：CORS 安全收紧

**用户故事：**
```
作为系统安全（工程需求），
生产环境的 CORS 配置必须限制为具体域名，
以消除 allow_origins=["*"] 带来的安全风险。
```

**验收标准：**
- [ ] `main.py` 中 CORS 配置改为从 `CORS_ORIGINS` 环境变量读取
- [ ] 开发环境默认值为 `["http://localhost:3000"]`
- [ ] `.env.example` 和 `.env.production.example` 中补充 `CORS_ORIGINS` 配置说明
- [ ] 生产环境未配置 `CORS_ORIGINS` 时，启动时输出警告日志

**优先级：** P0（Must Have）
**工作量估计：** S（1 人天）

---

#### P1 应该实现

---

##### Story 5.4：解决超管社区总览 N+1 问题

**用户故事：**
```
作为平台超级管理员，
我希望"所有社区总览"页面加载速度不受社区数量增长影响，
以便在管理大量社区时仍有良好体验。
```

**验收标准：**
- [ ] 新增端点：`GET /api/communities/overview/stats`（仅超管可访问）
- [ ] 使用 JOIN + GROUP BY 一次查询所有社区的统计数据（内容数、成员数、渠道数），替代原来 N×4 个请求
- [ ] 前端 `CommunityOverview.vue` 改用此新 API

**优先级：** P1（Should Have）
**工作量估计：** M（3-5 人天）

---

##### Story 5.5：结构化日志替换 print()

**用户故事：**
```
作为运维人员，
系统日志应使用结构化格式输出，
以便生产环境的日志采集和问题排查。
```

**验收标准：**
- [ ] 新建 `backend/app/core/logging.py`，提供 `setup_logging()` 和 `get_logger(name)` 工厂函数，支持 text/json 两种格式
- [ ] `database.py`、`wechat.py`、`auth.py` 中 4 处 `print()` 替换为结构化日志
- [ ] `config.py` 新增 `LOG_LEVEL`（默认 INFO）、`LOG_FORMAT`（text/json）、`ENVIRONMENT`（development/staging/production）
- [ ] 生产环境默认使用 JSON 格式日志

**优先级：** P1（Should Have）
**工作量估计：** M（3-4 人天）

---

### 功能需求汇总

| 需求 ID | 描述 | 优先级 | 状态 |
|---------|------|--------|------|
| FR-001 | 社区工作台——8 项指标卡片 | P0 | 待开发 |
| FR-002 | 社区工作台——内容发布趋势图 | P0 | 待开发 |
| FR-003 | 社区工作台——工作队列（内容+会议） | P0 | 待开发 |
| FR-004 | 社区工作台——快捷操作按钮组（按权限显示） | P0 | 待开发 |
| FR-005 | 五步社区初始化向导（仅超管可用） | P0 | 待开发 |
| FR-006 | SMTP 自动识别与测试（仅超管可配置） | P0 | 待开发 |
| FR-007 | 统一社区设置中心（5 Tab 按权限分层） | P0 | 待开发 |
| FR-008 | 社区创建入口（仅超管可见） | P0 | 待开发 |
| FR-009 | 导航菜单重组 | P0 | 待开发 |
| FR-010 | 社区切换上下文联动 | P0 | 待开发 |
| FR-011 | 后端工作台聚合 API | P0 | 待开发 |
| FR-012 | 修复 analytics 多租户漏洞 | P0 | 待开发 |
| FR-013 | CORS 配置收紧 | P0 | 待开发 |
| FR-014 | 权限控制中间件（社区创建/删除/配置） | P0 | 待开发 |
| FR-015 | 社区工作台——事件日历视图（多色标记） | P1 | 待开发 |
| FR-016 | 新社区引导横幅 | P1 | 待开发 |
| FR-017 | 超管社区总览聚合 API | P1 | 待开发 |
| FR-018 | 结构化日志系统 | P1 | 待开发 |
| FR-019 | 速率限制（slowapi） | P1 | 待开发 |
| FR-020 | 生产部署加固（Docker/Nginx） | P2 | 待开发 |

### 非功能需求

| 需求 ID | 类别 | 描述 | 目标值 |
|---------|------|------|--------|
| NFR-001 | 性能 | 工作台页面完整加载时间 | < 1 秒 |
| NFR-002 | 性能 | 工作台聚合 API 响应时间 p95 | < 500ms |
| NFR-003 | 安全 | 多租户数据隔离 | 所有端点强制 community_id 过滤 |
| NFR-004 | 安全 | CORS 配置 | 生产环境限定具体域名 |
| NFR-005 | 安全 | 登录端点速率限制 | 10 次/分钟 |
| NFR-006 | 安全 | 权限分层控制 | 社区创建/删除/关键配置仅 Superuser 可访问 |
| NFR-007 | 安全 | 前端权限隔离 | 根据角色动态显示/隐藏功能入口 |
| NFR-008 | 可测试性 | 后端代码覆盖率 | ≥ 80% |
| NFR-009 | 可测试性 | 权限测试覆盖 | 所有权限端点有对应测试用例 |
| NFR-010 | 可维护性 | 结构化日志 | 生产环境 JSON 格式，无 print() |
| NFR-011 | 可用性 | 初始化向导完成率 | 新社区超管向导完成率 ≥ 70% |

---

## 成功指标

### 北极星指标（North Star）

**指标：** 社区 PM 的日常工作流完成率（Work Session Completion Rate）
**定义：** PM 在单次登录中完成「查看社区状态 + 处理至少一项内容/会议任务」的比例
**当前基线：** 约 35%（估算，基于当前多页面跳转的摩擦）
**目标：** 60%（上线后 3 个月）
**选择理由：** 该指标直接反映系统是否真正帮助 PM 在一个会话中完成工作，而不仅仅是"登录后查看一下就关闭"

### OKRs

**目标（O）：** 让 openGecko 成为社区 PM 每天必用的运营工作台

**关键结果（KR）：**
1. PM 完成日常工作流（查看状态→处理内容→跟进会议）的页面跳转次数减少 ≥ 50%（从 5+ 次降至 ≤ 2 次）
2. 新社区从创建到首次发布内容的完成时间 < 10 分钟（通过向导引导）
3. 社区工作台数据加载时间 < 1 秒（p95）
4. analytics 多租户漏洞和 CORS 配置问题 100% 修复，通过安全代码审查

### 次要指标

| 指标 | 当前基线 | 目标值 | 时间窗口 |
|------|----------|--------|----------|
| 初始化向导完成率 | N/A（功能未上线） | ≥ 70% | 上线后 1 个月 |
| 工作台 API 响应时间（p95） | N/A | < 500ms | 上线时 |
| 后端测试覆盖率 | 未知 | ≥ 80% | 各阶段完成时 |
| PM 每周登录频率 | 3 次/周（估算） | 5 次/周 | 上线后 2 个月 |
| 安全漏洞 | 2 个已知漏洞 | 0 个 | 第二阶段完成时 |

### HEART 框架评估

| 维度 | 目标 | 衡量信号 | 指标 |
|------|------|----------|------|
| **Happiness（满意度）** | PM 喜欢工作台体验 | 功能使用后主动反馈 | 向导完成率 ≥ 70% |
| **Engagement（参与度）** | PM 每天使用工作台 | 工作台页面日访问量 | 日访问频率 ≥ 1 次/工作日 |
| **Adoption（采用率）** | PM 将工作台作为默认工作入口 | 工作台为首个打开页面的比例 | ≥ 80% 会话以工作台开始 |
| **Retention（留存）** | PM 持续使用 openGecko | 周活跃 PM 数量 | 周活跃比例 ≥ 80% |
| **Task Success（任务成功率）** | PM 能在工作台完成核心任务 | 工作流完成率 | ≥ 60% |

---

## 范围

### 本次交付范围（MVP）

**第一阶段（基础设施）：**
- 结构化日志系统（替换 print()）
- 环境变量管理增强（CORS_ORIGINS 等）
- CORS 安全收紧
- 速率限制（slowapi）

**第二阶段（后端 API + 权限控制）：**
- 社区工作台聚合 API（`/communities/{id}/dashboard`）
- 修复 analytics 多租户漏洞
- 超管社区总览聚合 API（解决 N+1）
- 权限控制中间件增强（`get_community_admin`、社区创建/删除/配置 API 权限）
- 社区创建/删除 API（仅超管）
- 社区基本信息/SMTP/渠道配置分离 API（按权限分级）

**第三阶段（核心 UX 改造）：**
- 社区工作台页面（CommunitySandbox.vue）
- 导航菜单重组
- 社区切换上下文联动
- 前端权限状态管理（authStore 增强）

**第四阶段（配置与引导）：**
- 五步社区初始化向导（仅超管可用）
- 统一社区设置中心（5 Tab 按权限分层）
- 社区创建入口（仅超管可见）
- 新社区引导横幅

**第五阶段（生产部署加固，可与三/四阶段并行）：**
- Docker Compose 健康检查和资源限制
- Nginx 安全头配置
- 多环境配置模板

### 明确不在本次范围

- 不重构现有内容编辑器（TipTap/富文本功能）
- 不修改现有 RBAC 三级角色模型（Superuser/Admin/User），仅明确权限边界
- 不新增第四种角色（如 Moderator、Editor 等）
- 不新增发布渠道（如 LinkedIn、X/Twitter）
- 不实现实时通知（WebSocket/SSE）
- 不做移动端原生适配
- 不引入外部分析工具（Sentry、Prometheus）的前端埋点
- 不实现细粒度权限（如基于资源的访问控制 RBAC-Per-Resource）

### 未来考量（下一阶段）

- 工作台 widget 自定义布局（拖拽排列）
- 社区运营周报自动生成（邮件推送）
- 内容排期日历视图
- 渠道发布效果 A/B 对比

---

## 技术考量

### 高层架构

```
前端（Vue 3 + TypeScript）
  └── CommunitySandbox.vue（新建）
      ├── 调用 communityDashboard.ts API 模块（新建）
      └── 渲染 Dashboard 组件（新建 7 个组件 + ECharts 图表 + 日历组件）
          ├── MetricsCards.vue（8 项指标卡片）
          ├── PublishTrendChart.vue（折线图）
          ├── ChannelStatsChart.vue（条形图）
          ├── CommunityCalendar.vue（日历视图，新增）
          ├── RecentContents.vue（最近内容列表）
          ├── UpcomingMeetings.vue（即将会议列表）
          └── UpcomingEvents.vue（即将到来的事件，新增）

后端（FastAPI）
  └── community_dashboard.py Router（新建）
      ├── GET /api/communities/{id}/dashboard
      └── 聚合查询 → 单次 DB 请求
          ├── 指标数据聚合
          ├── 趋势数据聚合
          └── 事件数据聚合（新增）

数据库（SQLite/PostgreSQL）
  └── 现有表：不新增表
      └── JOIN 查询：contents + publish_records + committees + meetings + community_users
          └── 事件聚合来源：
              ├── meetings 表 → 会议事件
              ├── publish_records 表 → 内容发布事件
              └── community_users 表 → 成员加入事件
```

### 技术栈

**前端新增依赖：**
- `echarts@^5.x` —— 图表渲染
- `vue-echarts@^7.x` —— Vue 3 封装
- `@fullcalendar/vue3@^6.x` —— 日历组件（或使用 Element Plus Calendar）
- `@fullcalendar/core@^6.x` —— FullCalendar 核心（如使用 FullCalendar）

**后端新增依赖：**
- `slowapi` —— 速率限制
- `python-json-logger` —— JSON 格式结构化日志
- `gunicorn` —— 生产环境多 worker 管理

### API 需求

**新建端点：**
```
GET /api/communities/{community_id}/dashboard
  → 返回工作台完整数据集（聚合）
  → 权限：当前社区的 admin 或 user（读取）

GET /api/communities/overview/stats
  → 返回所有社区汇总统计
  → 权限：superuser only

POST /api/communities
  → 创建新社区
  → 权限：superuser only（Depends(get_current_active_superuser)）

DELETE /api/communities/{community_id}
  → 删除社区
  → 权限：superuser only（Depends(get_current_active_superuser)）

PUT /api/communities/{community_id}/basic
  → 更新社区基本信息（名称、描述、Logo）
  → 权限：当前社区的 admin（Depends(get_community_admin)）

PUT /api/communities/{community_id}/smtp
  → 配置 SMTP 邮件设置
  → 权限：superuser only（Depends(get_current_active_superuser)）

PUT /api/communities/{community_id}/channels
  → 配置渠道凭证（微信/Hugo/CSDN/知乎）
  → 权限：superuser only（Depends(get_current_active_superuser)）
```

**修改端点：**
```
GET /api/analytics/overview
  → 添加 Depends(get_current_community) 强制 community_id 过滤
  → 权限：当前社区的 admin 或 user
```

### 安全要求

- **认证：** JWT（保持现有方案）
- **授权：** RBAC（保持现有 Depends 模式）
- **多租户隔离：** 所有新端点通过 `get_current_community` 依赖强制过滤
- **CORS：** 生产环境从环境变量读取域名白名单，禁止 `allow_origins=["*"]`
- **速率限制：** 登录端点 10 次/分钟，默认端点 120 次/分钟

### 性能要求

- 工作台聚合 API 响应时间 p95 < 500ms
- 前端页面首次完整加载 < 1 秒
- ECharts 图表初始渲染 < 300ms

### 数据模型

无新增数据库表。工作台数据通过以下现有表 JOIN 聚合查询：
- `contents`（内容指标）
- `publish_records`（渠道发布统计和趋势）
- `committees`（治理指标）
- `meetings`（会议指标）
- `community_users`（成员指标）
- `channel_configs`（渠道配置状态）

---

## 设计与用户体验要求

### UX 原则

1. **社区优先（Community First）：** 每个页面都应清晰展示当前社区上下文，用户永远知道"我在管理哪个社区"
2. **减少认知负担（Reduce Cognitive Load）：** 工作台聚合信息，替代用户在脑中手动整合多个页面的数据
3. **任务驱动（Task-Driven）：** 从用户的实际工作任务出发设计导航，而非从系统功能模块出发
4. **渐进式引导（Progressive Onboarding）：** 新用户通过向导完成配置，有经验用户可直接操作

### 工作台页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ [社区 Logo] 社区名称              [新建内容][邀请成员][设置]   │  ← 社区 Header
│ 社区描述文字                                                     │
├─────────────────────────────────────────────────────────────────┤
│ [内容总数]  [已发布]  [待审核]  [草稿]   — 内容指标行            │
├─────────────────────────────────────────────────────────────────┤
│ [委员会数]  [成员数]  [即将会议] [活跃渠道] — 治理指标行          │
├────────────────────────┬────────────────────────────────────────┤
│  内容发布趋势（折线图） │  渠道发布统计（条形图）                │
│  近 6 个月             │  微信/Hugo/CSDN/知乎                   │
├────────────────────────┴────────────────────────────────────────┤
│  社区事件日历（月视图）                                          │
│  ┌──────────────────────────────────────────────────┐          │
│  │  2026年2月     [◀] [今天] [▶]                    │          │
│  ├──────────────────────────────────────────────────┤          │
│  │ 日 一 二 三 四 五 六                               │          │
│  │ .. 17 18 19 20 21 22  ← 不同颜色圆点标记事件      │          │
│  │ 23 24 25 26 27 28 29                             │          │
│  └──────────────────────────────────────────────────┘          │
│  图例：🔵 会议  🟢 内容发布  🟠 成员活动  🟣 其他                │
├────────────────────────┬────────────────────────────────────────┤
│  最近内容（5条）        │  即将到来的事件（未来7天）             │
│  标题 | 状态 | 时间    │  事件类型 | 标题 | 时间                │
└────────────────────────┴────────────────────────────────────────┘
```

**布局说明：**
- 顶部：社区 Header 和快捷操作按钮
- 第一层：8 个核心指标卡片（2 行 × 4 列）
- 第二层：内容发布趋势图 + 渠道发布统计图（左右各 50%）
- 第三层：社区事件日历（全宽，月视图）
- 第四层：最近内容列表 + 即将到来的事件列表（左右各 50%）

### 设计系统要求

遵循 LFX Insights 浅色主题设计规范（详见 `.claude/skills/opengecko-lfx-design-system.md`）：
- CSS 变量：`--text-primary: #1e293b`、`--blue: #0095ff`
- 禁止使用：`#409EFF`、`--el-color-primary` 等 Element Plus 默认色
- 统一页面 padding、卡片阴影规范

### 用户流程

**首次使用流程（新社区 PM）：**
```
注册/激活账号
    ↓
选择/加入社区
    ↓
进入社区工作台（检测到空社区）
    ↓
[引导横幅] → 点击「开始引导」
    ↓
Step 1：填写基本信息
    ↓
Step 2：配置渠道（可跳过）
    ↓
Step 3：邮件设置（可跳过）
    ↓
Step 4：邀请成员（可跳过）
    ↓
Step 5：完成 → 进入工作台
    ↓
创建第一篇内容 → 配置发布 → 完成首次发布
```

**日常使用流程（有经验 PM）：**
```
登录 → 社区工作台（默认页）
    ↓
查看指标卡片（了解今日状态）
    ↓
点击「待审核 3」→ 内容管理页（过滤待审核）
    ↓
处理审核 → 返回工作台
    ↓
查看「即将召开的会议」→ 点击会议跳转详情
    ↓
完成当日工作
```

### 无障碍要求

- 指标卡片提供语义化标签（`aria-label`）
- ECharts 图表提供文字版数据摘要（屏幕阅读器可读）
- 所有交互按钮支持键盘操作
- 色彩对比度符合 WCAG 2.1 AA 标准

---

## 时间线与里程碑

| 阶段 | 交付内容 | 预计周期 |
|------|----------|----------|
| **第一阶段** | 结构化日志 + CORS 修复 + 速率限制 + 环境变量 | 1 周 |
| **第二阶段** | 工作台聚合 API + analytics 漏洞修复 + N+1 优化 + **权限控制中间件** + **社区创建/删除/配置 API** | 2 周（增加权限控制） |
| **第三阶段** | 社区工作台前端页面 + 导航重组 + 社区切换联动 + **前端权限状态管理** | 2.5 周（增加权限 UI） |
| **第四阶段** | 初始化向导（仅超管） + 统一设置中心（分权限分层） + **社区创建入口** | 2.5 周（增加权限逻辑） |
| **第五阶段** | Docker/Nginx 生产加固（可与三/四并行） | 1 周 |

**总计：** 约 9 周（较原计划增加 1.5 周用于权限控制实现）

**关键里程碑：**
- 第一阶段完成后：安全漏洞修复，可进行安全代码审查
- 第二阶段完成后：后端 API 完备，**权限控制机制就绪**，前端开发可全速推进
- 第三阶段完成后：核心 UX 改造上线，可开始管理员用户测试
- 第四阶段完成后：**权限分层全面落地**，可进行超管用户验收
- 全部阶段完成后：可进行生产环境部署验收

---

## 风险与缓解措施

| 风险 | 影响 | 概率 | 缓解策略 |
|------|------|------|----------|
| 工作台聚合 API 查询性能不达标（> 500ms） | 高（影响核心体验） | 中 | 预先分析查询计划；复杂查询添加数据库索引；必要时分拆为 2 个请求 |
| 权限控制逻辑遗漏导致安全漏洞 | 高（安全风险） | 中 | 所有权限端点编写单元测试；代码审查重点检查权限中间件使用；penetration testing |
| 现有社区管理员失去关键配置权限导致用户不满 | 中（用户体验） | 中 | 发布前明确沟通权限变更；提供文档说明职责分离原因；提供超管快速响应通道 |
| 向导步骤过多导致超管放弃初始化 | 中（影响激活率） | 中 | 所有步骤均可跳过；进度条清晰展示；收集完成率数据后迭代 |
| ECharts 打包体积影响页面加载性能 | 中 | 低 | 使用按需引入（Tree Shaking）；ECharts 组件懒加载 |
| 迁移现有设置页面时数据/API 变化导致功能回退 | 高（影响现有用户） | 低 | 功能迁移前完整测试现有 API；迁移后保留原路由重定向 |
| analytics 漏洞修复影响现有数据查询逻辑 | 中 | 低 | 修复前完整读取现有逻辑；添加对应测试用例；staging 验证 |

---

## 依赖与假设

### 依赖

**内部依赖：**
- [ ] 现有渠道配置 API 可复用于初始化向导 Step 2
- [ ] 现有 SMTP 配置 API 可复用于向导 Step 3
- [ ] 现有成员邀请 API 可复用于向导 Step 4
- [ ] Alembic 迁移机制可用（本次无新建表，但需验证）

**外部依赖：**
- [ ] npm 可访问以安装 `echarts`、`vue-echarts`、`@fullcalendar/vue3`（或使用 Element Plus Calendar）
- [ ] PyPI 可访问以安装 `slowapi`、`python-json-logger`、`gunicorn`

### 假设

- 现有后端数据库 Schema 中，`contents`/`meetings`/`committees`/`community_users` 等表数据足以支持聚合查询
- 前端项目使用 Vite，ECharts 按需引入的 Tree Shaking 可正常工作
- 用户在当前浏览器会话中不会同时操作两个社区（上下文切换是显式操作）

---

## 待解决问题

- [ ] **工作台指标刷新策略**
  - **背景：** 工作台数据是否需要自动刷新（如每 5 分钟），还是仅在页面加载时获取一次？
  - **选项：** A）仅页面加载时请求；B）定时轮询（5 分钟）；C）添加「手动刷新」按钮
  - **负责人：** 产品负责人
  - **截止时间：** 第三阶段开发开始前

- [ ] **向导的持久化策略**
  - **背景：** 用户在向导中途关闭浏览器，已填写的数据是否应该保留？
  - **选项：** A）不保留，每次重新开始；B）保存到 localStorage，下次打开恢复
  - **负责人：** 产品负责人
  - **截止时间：** 第四阶段开发开始前

- [ ] **多社区 PM 的工作台默认社区**
  - **背景：** 管理多个社区的 PM 登录后，工作台应默认显示哪个社区？
  - **选项：** A）上次登录时选中的社区；B）第一个社区；C）让用户在登录后选择
  - **负责人：** 产品负责人
  - **截止时间：** 第三阶段开发开始前

---

## 利益相关者确认

| 角色 | 审阅状态 | 确认 | 日期 |
|------|----------|------|------|
| 产品负责人 | ⏳ 待审阅 | ☐ | - |
| 前端负责人 | ⏳ 待审阅 | ☐ | - |
| 后端负责人 | ⏳ 待审阅 | ☐ | - |
| 安全/运维 | ⏳ 待审阅 | ☐ | - |

---

## 附录

### 术语表

- **Community Sandbox / 社区工作台：** 以单个社区为核心的运营数据总览页面
- **CommunitySwitcher：** 导航栏中用于切换当前操作社区的组件
- **N+1 查询：** 对 N 个对象发出 N+1 次数据库请求的性能反模式
- **多租户隔离：** 确保不同社区数据相互独立、不可越权访问的机制
- **超管（Superuser）：** 拥有跨所有社区管理权限的平台级别角色，唯一可执行社区创建/删除/关键配置的角色
- **社区管理员（Community Admin）：** 社区级管理员，负责日常运营，可编辑社区基本信息、管理成员和内容
- **普通用户（Community User）：** 社区普通成员，可创建内容、参加会议，无管理权限
- **权限分层（Permission Hierarchy）：** 系统按职责划分的三级权限模型（Superuser > Admin > User）

### 变更日志

| 版本 | 日期 | 作者 | 变更内容 |
|------|------|------|----------|
| 1.0 | 2026-02-20 | Claude | 初始版本，基于综合重构计划 v1 生成 |
| 1.1 | 2026-02-20 | Claude | 优化权限分层：明确社区创建/删除/关键配置由超管统一完成，社区管理员仅能编辑基本信息；新增权限矩阵、更新用户画像、调整相关 Story 验收标准 |
| 1.2 | 2026-02-20 | Claude | 新增社区事件日历视图功能（Story 1.6）：支持月视图展示不同类型事件（会议/内容发布/成员活动/其他），使用颜色区分；更新工作台聚合 API 增加 events 字段；更新页面布局和技术架构 |
